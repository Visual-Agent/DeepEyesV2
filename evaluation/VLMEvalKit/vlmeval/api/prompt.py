

THINKING_CONFIG = {
    'system_prompt': ('A conversation between User and Assistant. The user asks a question, '
                     'and the Assistant solves it. The assistant first thinks about the reasoning '
                     'process in the mind and then provides the user with the answer. The reasoning '
                     'process and answer are enclosed within <think></think>and <answer></answer>tags, '
                     'respectively, i.e., <think>reasoning process here </think><answer>answer here </answer>'),
    'user_template': 'Answer the following question: {original_text}\nPlease reason step by step. The reasoning process and answer are enclosed within <think></think>and <answer></answer>tags, respectively, i.e., <think>reasoning process here </think><answer>answer here </answer>.',
    'fallback_text': 'Answer the following question: \nPlease reason step by step. The reasoning process and answer are enclosed within <think></think>and <answer></answer>tags, respectively, i.e., <think>reasoning process here </think><answer>answer here </answer>',
    'think_regex': r'<think>(.*?)</think>',
    'answer_regex': r'<answer>(.*?)</answer>',
    'retry_on_missing_tags': True, 
    'max_tag_retries': 3,          
    'tag_retry_delay': 1          
}



AGENT_CONFIG = {
    'system_prompt': """You are an agent - please keep going until the user's query is completely resolved, before ending your turn and yielding back to the user. Only terminate your turn when you are sure that the problem is solved.

Solve the following problem step by step. In your reasoning process, if the answer cannot be determined, you can write Python code in a Jupyter Notebook to process the image and extract more information from it. The stdout and stderr content, along with the images generated by `plt.show()` will be returned to better assist with the user query.

You MUST use the python tool to analyze or transform images whenever it could improve your understanding. This includes but is not limited to zooming in, rotating, adjusting contrast, computing statistics, or isolating features.

You MUST plan extensively before each function call, and reflect extensively on the outcomes of the previous function calls. DO NOT do this entire process by making function calls only, as this can impair your ability to solve the problem and think insightfully.

For all the provided images, in order, the i-th image has already been read into the global variable "image_i" using the "PIL.Image.open()" function. For example, the first image can be accessed as "image_1". When writing Python code, you can directly use these variables without needing to read them again.

Your python code should be enclosed within <code> </code> tag.
 
Example for calling Python code in Jupyter Notebook:
<code>
```python
# python code here
```
</code>

Note:
1. **python** can be called to analyze the image. **python** will respond with the output of the execution or time out after 300.0 seconds. 
2. Like jupyter notebook, you can use Python code to process the input image and use `plt.show()` to visualize processed images in your code.
3. All python code are running in the same jupyter notebook kernel, which means the functions and variables are automatically stored after code execution.
4. You program should always returns in finite time. Do not write infinite loop in your code.
5. Writing file to disk is not allowed.
""",
    'user_template': """{question}\n\nYou must put your answer inside <answer> </answer> tags, i.e., <answer> answer here </answer>. Please reason step by step. Use Python code to process the image if necessary. Format strictly as <think> </think> <code> </code> (if code is needed) or <think> <think> <answer> </answer>.""",
    'fallback_text': """\nYou must put your answer inside <answer> </answer> tags, i.e., <answer> answer here </answer>. Please reason step by step. Use Python code to process the image if necessary. Format strictly as <think> </think> <code> </code> (if code is needed) or <think> <think> <answer> </answer>.""",
    'return_template': """Code execution result:
stdout:
```
{stdout}
```

stderr:
```
{stderr}
```

Images:\n""",
    'think_regex': r'<think>(.*?)</think>',
    'answer_regex': r'<answer>(.*?)</answer>',
    'answer_prefix': '<answer>',
    'answer_suffix': '</answer>',
    'code_regex': r'<code>(.*?)</code>',
    'code_prefix': '<code>',
    'code_suffix': '</code>',
    'python_prefix': '```python',
    'python_suffix': '```',
    'stop_token': ['</code>', "<|im_end|>\n".strip()],
    'retry_on_missing_tags': True,  
    'max_tag_retries': 3,         
    'tag_retry_delay': 1          
}